{
	"project": "headless-framework",
	"branchName": "xshaheen/feat-transport-publisher",
	"description": "Add ITransportPublisher for Direct Transport Publishing",
	"userStories": [
		{
			"id": "US-001",
			"title": "Create ITransportPublisher interface in Abstractions",
			"description": "Define the ITransportPublisher interface in Headless.Messaging.Abstractions with PublishAsync and PublishManyAsync methods",
			"size": "S",
			"acceptanceCriteria": [
				"ITransportPublisher interface defined in Headless.Messaging namespace",
				"PublishAsync<T>(string name, T? value, CancellationToken) method defined",
				"PublishAsync<T>(string name, T? value, IDictionary headers, CancellationToken) method defined",
				"PublishAsync<T>(T? value, CancellationToken) where T : class method defined",
				"PublishAsync<T>(T? value, IDictionary headers, CancellationToken) where T : class method defined",
				"PublishManyAsync<T>(string name, IEnumerable values, CancellationToken) method defined",
				"PublishManyAsync<T>(IEnumerable values, CancellationToken) where T : class method defined",
				"All methods return Task<OperateResult> or Task<IReadOnlyList<OperateResult>>",
				"Complete XML documentation for interface and all methods"
			],
			"priority": 1,
			"passes": false,
			"notes": "Core API definition - must be done first"
		},
		{
			"id": "US-002",
			"title": "Implement TransportPublisher in Core",
			"description": "Create TransportPublisher class implementing ITransportPublisher with header generation, serialization, and transport send",
			"size": "M",
			"acceptanceCriteria": [
				"TransportPublisher class in Headless.Messaging.Internal namespace",
				"Auto-generates MessageId via ILongIdGenerator",
				"Auto-generates CorrelationId (set to MessageId if not provided)",
				"Auto-generates CorrelationSequence (set to 0 if not provided)",
				"Sets MessageName header to topic name",
				"Sets Type header to typeof(T).Name",
				"Sets SentTime header to current UTC time",
				"Applies TopicNamePrefix when configured",
				"Resolves topic from TopicMappings for type-safe overloads",
				"User-provided headers merged with system headers (user wins for non-reserved)",
				"Returns OperateResult.Failed on transport errors (no throw)",
				"Throws ArgumentNullException for null/empty topic name",
				"Throws InvalidOperationException for missing topic mapping"
			],
			"priority": 2,
			"passes": false,
			"notes": "Depends on US-001"
		},
		{
			"id": "US-003",
			"title": "Add batch publishing (PublishManyAsync)",
			"description": "Implement efficient PublishManyAsync methods for bulk message publishing",
			"size": "M",
			"acceptanceCriteria": [
				"PublishManyAsync sends all messages in sequence",
				"Returns IReadOnlyList<OperateResult> with result per message in order",
				"Respects CancellationToken between messages",
				"Throws ArgumentNullException for null values parameter",
				"Works with both explicit topic name and topic mapping overloads"
			],
			"priority": 3,
			"passes": false,
			"notes": "Part of US-002 implementation"
		},
		{
			"id": "US-004",
			"title": "Add DiagnosticListener/tracing integration",
			"description": "Integrate with existing messaging diagnostics for observability",
			"size": "S",
			"acceptanceCriteria": [
				"Creates DiagnosticListener events using MessageDiagnosticListenerNames.BeforePublish",
				"Creates DiagnosticListener events using MessageDiagnosticListenerNames.AfterPublish on success",
				"Creates DiagnosticListener events using MessageDiagnosticListenerNames.ErrorPublish on failure",
				"Events include TransportMessage and BrokerAddress",
				"OpenTelemetry spans created for distributed tracing"
			],
			"priority": 4,
			"passes": false,
			"notes": "Follow pattern from MessageSender"
		},
		{
			"id": "US-005",
			"title": "Register in DI via IMessagingBuilder",
			"description": "Add service registration for ITransportPublisher in the messaging setup",
			"size": "S",
			"acceptanceCriteria": [
				"ITransportPublisher registered as Singleton",
				"Registration happens in AddMessaging or equivalent setup method",
				"Uses TryAddSingleton to allow override"
			],
			"priority": 5,
			"passes": false,
			"notes": "Simple registration in Setup.cs"
		},
		{
			"id": "US-006",
			"title": "Write unit tests",
			"description": "Create comprehensive unit tests for TransportPublisher",
			"size": "M",
			"acceptanceCriteria": [
				"Tests for header auto-generation (MessageId, CorrelationId, etc.)",
				"Tests for user header merging",
				"Tests for TopicNamePrefix application",
				"Tests for TopicMappings resolution",
				"Tests for error handling (OperateResult.Failed returned)",
				"Tests for exception throwing (null topic, missing mapping)",
				"Tests for PublishManyAsync behavior",
				"Tests for cancellation token respect",
				"Mock ITransport, ISerializer, ILongIdGenerator",
				">=85% line coverage, >=80% branch coverage"
			],
			"priority": 6,
			"passes": false,
			"notes": "In Headless.Messaging.Core.Tests.Unit"
		},
		{
			"id": "US-007",
			"title": "Write integration tests",
			"description": "Create integration tests with real transport",
			"size": "M",
			"acceptanceCriteria": [
				"Integration tests using InMemoryQueue transport",
				"Verify messages are received by consumers",
				"Verify headers are correctly populated",
				"Test concurrent publishing (thread safety)",
				"Test large payloads"
			],
			"priority": 7,
			"passes": false,
			"notes": "Use existing test harness patterns"
		},
		{
			"id": "US-008",
			"title": "Update README and XML docs",
			"description": "Document the new ITransportPublisher interface",
			"size": "S",
			"acceptanceCriteria": [
				"XML documentation complete on ITransportPublisher interface",
				"XML documentation complete on all public methods",
				"README.md in Headless.Messaging.Abstractions updated",
				"Usage examples provided",
				"Difference from IOutboxPublisher explained"
			],
			"priority": 8,
			"passes": false,
			"notes": "Documentation follows existing patterns"
		}
	],
	"passes": false,
	"validation_errors": []
}
